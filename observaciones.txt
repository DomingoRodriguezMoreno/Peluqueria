pagina citas:
Estoy usando esa base de datos para crear una pagina para una peluqueria, 
ahora estoy con la interfaz de las citas,  te explico brevemente como deseo que funcione, 
la pagina debe conectarse con la base de datos y extraer los tratamientos para luego ponerlos 
presentarselos al cliente de la sigiente manera Nombre | descripcion | tiempo | coste | ceckhbox, 
la funcion de la checkbox es que al final de todo te ponga el coste y tiempo totales de todo lo 
que ha marcado ademas de identificar los tratamientos que se asociaran a la citas en la base de datos

tipos_tratamientos (Hecho)
Necesito incluir los tipos de los tratamiento para una funcinalidad futura, 
el dilema es como incluirlos me gusta la opcion de incluir una tabla de tipos_trtamiento 
que tenga una id y el nombre del tipo (1 cortes, 2 tintes, 3 barbas, ...) y otra tabla que 
asocie las ids de los tipos a las ids de los tratamientos como tabla de relacion. 

login: (corregido)
El desplegable del login solo esta disponible en la pagina principal
    correcion:
    Se ha incluido el login en el php de la barra de navegacion

Citas
Tienen 3 estados 'reservada', 'cancelada' y 'finalizada' una vez que pasa la hora final de la cita
su estado cambia de 'reservada' a 'finalizada' salvo que haya sido 'cancelada'. Para ello se usa un
evento que actualiza las citas cada minuto

coger citas
Ahora que ya tenemos esto quiero que me ayudes a crear la pagina para las citas, quiero una pagina que use el estilo principal, esta pagina será un interfaz para coger citas, se compondrá de una listados de los servicios disponibles, estos servicios tendrán un checkbox y según se vayan seleccionando servicios en un cuadro resumen en la esquina superior derecha aparecerán el tiempo y coste totales. Tras haber terminado se debe permitir que el cliente escoja el dia y la hora (dentro que las que sean posibles) para su cita

Panel empleado
Este muestra 4 botones que corresponden a la lista de empleados, clientes, citas y servicios. 
En la lista de empleados si el empleado que esta logeado es un admin apareceran las opciones 
de dar de alta y eliminar un trabajador. esto ocurrira tambien para los empleados


Tareas:
[X]    Cambio Boton login por perfil

[X]    Reemplazar toda eliminacion/baja por un valor en la BD llamado esta_activo
        para asi no eliminar nada de la BD

[X]    pagina perfil cliente
[X]        listado de citas propias
[X]             Debe Mostrar todas las citas incluso las canceladas
[X]             Alt: Al iniciar sesion tras una cancelacion por parte de
                los trabajadores Mostrar un mensaje

[X] pagina perfil trabajador
[X]     listado empleados
[X]         (Administrador) Dar alta nuevo empleado
[X]         (Administrador) Editar empleado
[X]             Manejo de error de duplicidad
[X]     listado clientes
[X]         (Administrador) Dar alta nuevo cliente
[X]         (Administrador) Editar cliente
[X]             Manejo de error de duplicacion de email
[X]     listado servicios
[X]         (Administrador) Dar alta nuevo servicio
[X]         (Administrador) Editar servicio
[X]     listado citas
[X]         Debe Mostrar todas las citas incluso las canceladas
[X]         (Administrador) Dar alta nuevo citas
[X]         (Administrador) Editar citas  

[X]     Gestion errores login

[X] pagina citas
[X]     Diferencia flujo de eventos Clientes/Trabajador
[X]         Citas propias (Clientes)
[X]             Mensaje de error, si no se coge la cita
[X]         Citas Agenas (Emplados)

[X] Sustituir Eliminacion por alteracion > añadir valor esta_activo a BD como identificacion de los
    trabajadores actuales

ERROR!!!!! (Solucionado)
Citas mal asociadas a servicios. La cita con el id 62 tiene 2 servicios asociados pero la suma total falla lo que da un error a la hora de cancelar junto la siguiente redireccion de error, te adjunto los datos de las tablas
https://drodmor970.tech/TFGPeluqueria/funcionalidades/panel_cliente.php?error=SQLSTATE%5B45000%5D%3A+%3C%3CUnknown+error%3E%3E%3A+1644+El+precio+final+no+coincide+con+la+suma+de+los+servicios.
https://drodmor970.tech/TFGPeluqueria/funcionalidades/citas.php?error=SQLSTATE%5B45000%5D%3A+%3C%3CUnknown+error%3E%3E%3A+1644+El+precio+final+no+coincide+con+la+suma+de+los+servicios.

mysql> select * from citas
    -> ;
+---------+------------+------------+-------------+----------+------------+----------------+--------------+
| id_cita | id_cliente | fecha_cita | hora_inicio | hora_fin | estado     | duracion_total | precio_final |
+---------+------------+------------+-------------+----------+------------+----------------+--------------+
|      23 |          1 | 2025-05-06 | 09:01:00    | 13:01:00 | finalizada |            240 |         1.00 |
|      24 |          1 | 2025-05-07 | 09:13:00    | 13:13:00 | finalizada |            240 |         1.00 |
|      25 |          1 | 2025-05-08 | 09:18:00    | 13:18:00 | finalizada |            240 |         1.00 |
|      26 |          1 | 2025-05-06 | 09:07:00    | 13:07:00 | finalizada |            240 |         1.00 |
|      27 |          1 | 2025-05-06 | 09:07:00    | 09:57:00 | finalizada |             50 |        20.50 |
|      28 |          1 | 2025-05-06 | 09:07:00    | 09:37:00 | finalizada |             30 |        20.01 |
|      39 |          1 | 2025-05-09 | 09:30:00    | 10:20:00 | cancelada  |             50 |        20.50 |
|      40 |          1 | 2025-05-08 | 09:00:00    | 13:00:00 | finalizada |            240 |         1.00 |
|      43 |          1 | 2025-05-14 | 09:00:00    | 10:00:00 | cancelada  |             60 |        50.00 |
|      44 |          1 | 2025-05-13 | 10:01:00    | 11:01:00 | finalizada |             60 |        50.00 |
|      45 |          2 | 2025-05-20 | 10:51:00    | 11:21:00 | cancelada  |             30 |        20.01 |
|      46 |          2 | 2025-05-26 | 11:07:00    | 12:07:00 | cancelada  |             60 |        50.00 |
|      47 |          1 | 2025-05-25 | 11:12:00    | 12:12:00 | cancelada  |             60 |        50.00 |
|      48 |          2 | 2025-05-23 | 09:31:00    | 10:51:00 | cancelada  |             80 |        40.51 |
|      51 |          2 | 2025-05-30 | 10:34:00    | 11:34:00 | cancelada  |             60 |        50.00 |
|      53 |          3 | 2025-05-30 | 09:29:00    | 10:49:00 | cancelada  |             80 |        40.51 |
|      55 |          3 | 2025-05-28 | 10:46:00    | 11:46:00 | reservada  |             60 |        50.00 |
|      56 |          2 | 2025-05-21 | 11:40:00    | 12:55:00 | reservada  |             75 |        50.01 |
|      58 |          1 | 2025-05-29 | 13:07:00    | 13:37:00 | cancelada  |             30 |        20.01 |
|      59 |          1 | 2025-05-26 | 11:07:00    | 12:07:00 | cancelada  |             60 |        50.00 |
|      62 |          1 | 2025-06-19 | 10:00:00    | 10:30:00 | reservada  |             30 |        20.01 |
+---------+------------+------------+-------------+----------+------------+----------------+--------------+
21 rows in set (0.00 sec)

mysql> select * from citas_servicios;
+---------+-------------+-------------+
| id_cita | id_servicio | id_empleado |
+---------+-------------+-------------+
|      23 |          10 | 12345678A   |
|      24 |          10 | 12345678A   |
|      25 |          10 | 12345678A   |
|      26 |          10 | 12345678A   |
|      27 |           4 | 12345678A   |
|      28 |           1 | 12345678A   |
|      39 |           4 | 12345678A   |
|      43 |           2 | 12345678A   |
|      44 |           2 | 12345678A   |
|      45 |           1 | 12345678A   |
|      46 |           2 | 12345678A   |
|      47 |           2 | 12345678A   |
|      48 |           1 | 12345678A   |
|      51 |           2 | 12345678A   |
|      53 |           1 | 12345678A   |
|      55 |           2 | 12345678A   |
|      56 |           1 | 12345678A   |
|      58 |           1 | 12345678A   |
|      59 |           2 | 12345678A   |
|      62 |           1 | 12345678A   |
|      62 |           4 | 12345678A   |
|      48 |           4 | 12345678B   |
|      53 |           4 | 12345678B   |
|      56 |           3 | 12345678X   |
|      40 |          10 | 87654321X   |
+---------+-------------+-------------+
25 rows in set (0.00 sec)

mysql> select * from servicios;
+-------------+--------------------+--------------------------------------+----------+--------+--------+
| id_servicio | nombre_servicio    | descripcion                          | duracion | precio | activo |
+-------------+--------------------+--------------------------------------+----------+--------+--------+
|           1 | Corte de caballero | Corte moderno y personalizado.       |       30 |  20.01 |      1 |
|           2 | Coloración         | Tinte y mechas profesionales.        |       60 |  50.00 |      1 |
|           3 | Depilación facial  | Depilación con cera en zona facial.  |       45 |  30.00 |      1 |
|           4 | Corte de mujer     | corte de cabello para mujeres        |       50 |  20.50 |      1 |
|          10 | Prueba 4           | tratamiento de 4 horas               |      240 |   1.00 |      0 |
+-------------+--------------------+--------------------------------------+----------+--------+--------+
5 rows in set (0.00 sec)

mysql>

Nuevas funcionalidades
[X] Cambio contraseña
[X]     Verificar contraseña previa
[X]     Repetir contraseña nueva

clientes, citas, empleados
[ ] Cabecera de tablas fija
[ ] Ordenacion por columnas
[ ] Busqueda en registros

sudo chown www-data:www-data procesar_cambio_contrasena.php && sudo chmod 755 procesar_cambio_contrasena.php

Completado
Implementar una funcionalidad que, al completarse la reserva de una cita en la peluquería, 
envíe automáticamente un correo electrónico de confirmación al cliente. Para ello, se utilizará 
la librería PHPMailer, que permite enviar correos desde PHP de forma segura y con soporte para 
autenticación SMTP. El correo incluirá los datos básicos de la cita 
(como fecha, hora y servicios contratados), y se enviará justo después de registrar la cita 
en la base de datos. 

Flujo normal
clientes >> pag coger_citas >> seleccionar servicios >> seleccionar dia/hora
Flujo trabajador
Trabajador >> pag intermedia >> Selecciona cliente >> pag coger_citas >> seleccionar servicios >> seleccionar dia/hora

Administrador (Solucionado)
eliminar el rol de administrador y añadir una columna a los empleados de tipo boolean llamada
"es_admin" que identificara a los adminstradores con un 1
Corregir todo lo que conlleva en las paginas/funciones que verifican que la sesion pertenece a 
in emleado administrador
    Solucion:
        como la verificacion de admin esta encampsulada en una funcionalidad php solo he tenido
        que modificar dicha funcionalidad y la pagina ha continuado su correcto funcionamiento

ademas tengo un dilema y es si poner dni como campo editable, el dilema viene a que dni es la primary key de la tabla empleados, pero como dato insertado por el usuario tambies es suceptible a errores al escribirlo

Servidor AWS
ssh -i TFG.pem ubuntu@13.219.48.123

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
//Eliminar los registros echos con la ip
ssh-keygen -R 13.219.48.123 

//Restauracion Backups
scp -i TFG.pem LastUpdate ubuntu@13.219.48.123:/home/ubuntu/

SCP
scp -i TFG.pem TFGPeluqueria.sql ubuntu@13.219.48.123:/home/ubuntu/
sudo mysql -u root -p < ~/TFGPeluqueria.sql

scp -i TFG.pem -r "TFGPeluqueria\*" ubuntu@13.219.48.123:~/TFGPeluqueria

CREATE USER 'domingo'@'localhost' IDENTIFIED BY 'doromo96';
GRANT ALL PRIVILEGES ON TFGPeluqueria.* TO 'domingo'@'localhost';
FLUSH PRIVILEGES;
EXIT;

$host = 'localhost'; // Servidor de la base de datos
$dbname = 'TFGPeluqueria'; // Nombre de la base de datos
$user = 'domingo'; // Usuario de MySQL (por defecto en XAMPP es 'root')
$password = 'doromo96'; // Contraseña de MySQL (por defecto en XAMPP está vacía)

        <div class="contenedor-busqueda">
                <input type="text" id="buscador-empleados" placeholder="Buscar..." class="input-busqueda">
        </div>

tree C:\xampp\htdocs\/TFGPeluqueria /F /A

Listado de rutas de carpetas
C:\XAMPP\HTDOCS\/TFGPeluqueria
|   index.php 
|   observaciones.txt
|
+---BD
|       /TFGPeluqueria.sql
|
+---css
|       styles.css
|
+---funcionalidades
|       conexion.php
|       login.php
|       logout.php
|       procesar_cita.php
|       procesar_registro_cliente.php
|       procesar_registro_empleados.php
|       procesar_tratamiento.php
|       verificar_admin.php
|
+---js
|       script.js
|
+---paginas
|       citas.php
|       clientes.php
|       eliminarEmpleado.php
|       empleados.php
|       panel_cliente.php
|       panel_empleado.php
|       registro_cliente.php
|       registro_empleados.php
|       registro_tratamiento.php
|       servicios.php
|
\---plantillas
        navbar.php

Presentacion
Abrir Pagina >> Mostrar servicios >> login Empleado >> Pagina Empleados >> logout
Login Empleado Admin >> Alta empleado >> baja empleado >> alta servicio >> logout
Login Cliente >> Panel cliente >> Cogercita (nuevo servicio) >> panel cliente >> Fin

Formato memoria? (reunion anterior)
Fecha limite 


index.php
conexion.php
login.php
logout.php
procesar_cita.php
procesar_registro_cliente.php
procesar_registro_empleados.php
procesar_servicio.php
verificar_admin.php
script.js
citas.php
clientes.php
coger_citas.php
eliminarEmpleado.php
eliminar_sercicio.php
empleados.php
panel_cliente.php
panel_empleado.php
registro_cliente.php
registro_empleados.php
registro_servicio.php
servicios.php
navbar.php

estructura en servidor:
ubuntu@ip-172-31-94-16:~$ ls -R /var/www/html/
/var/www/html/:
TFGPeluqueria  index.php

/var/www/html/TFGPeluqueria:
css  funcionalidades  imagenes  index.php  js  paginas  plantillas

/var/www/html/TFGPeluqueria/css:
styles.css

/var/www/html/TFGPeluqueria/funcionalidades:
cancelar_cita.php  procesar_cita.php              procesar_edicion_servicio.php    verificar_admin.php
conexion.php       procesar_edicion_cita.php      procesar_registro_cliente.php
login.php          procesar_edicion_cliente.php   procesar_registro_empleados.php
logout.php         procesar_edicion_empleado.php  procesar_servicio.php

/var/www/html/TFGPeluqueria/imagenes:
Fondo.jpg  Logo.png  Logo2.png  Logo3.png  facebook.png  instagram.png

/var/www/html/TFGPeluqueria/js:
script.js

/var/www/html/TFGPeluqueria/paginas:
citas.php        editar_cliente.php     empleados.php         registro_empleados.php
clientes.php     editar_empleado.php    panel_cliente.php     registro_servicio.php
coger_citas.php  editar_servicio.php    panel_empleado.php    seleccionar_cliente.php
editar_cita.php  eliminar_sercicio.php  registro_cliente.php  servicios.php

/var/www/html/TFGPeluqueria/plantillas:
navbar.php

clave aplicacion: mcyu hirg dnxp kchs

copia de seguridad cada 2 horas para asegurar que una vez arrancada la instancia (4 horas)
sin importar la hora al menos hará una copia

Tendriamos un carpeta lamada por ejemplo copiaSeguridad (la ubicacion te la dejo a ti par buscar la mejor) me gustaria si fura posible que el script limpie el contenido de la carpeta para eliminar posibles copias anteriores, copie la  base de datos y los archivos de la web (Directorio /var/www/html/TFGPeluqueria/) a la carpeta copiaSeguridad comprima todo en un zip y usando rclone lo suba a mi drive ¿Como lo ves?


rclone
rclone authorize "drive" "eyJzY29wZSI6ImRyaXZlIn0"

codigo rclone
Paste the following into your remote machine --->
eyJ0b2tlbiI6IntcImFjY2Vzc190b2tlblwiOlwieWEyOS5hMEFaWWtOWmlVcnBId1BCbmtFUEpnc1pLVnR4Z3hLUnF1YTZqLUJUVzU0ZV9DV3QxZVR0aDRhSWhPQlZnY0hDOUQtcnhsemp1S3l6N2dMaTRpajMzdHAwN3FYdlRlXzJWOThCX3B5a0N6bnRUaHVicXJrLXVnZVNjTG1hQlRVVlA3X3EwMmhIdmpHaGFDRWt1R2ZENllpLU9VeU1yX0RsNHA4ZWg0M1hWaGFDZ1lLQVNVU0FSQVNGUUhHWDJNaUE4MWlLdl90UkUyNXVLcXFlZ0tzNlEwMTc1XCIsXCJ0b2tlbl90eXBlXCI6XCJCZWFyZXJcIixcInJlZnJlc2hfdG9rZW5cIjpcIjEvLzAzejM4MDlfU3o5b0RDZ1lJQVJBQUdBTVNOd0YtTDlJcmEwNVhOeG04bFJuWmRzRU5xYzZ1UTVLazlNRVJJSHRsdkZpSXNhTlJ2cFJfRWVuclF5d1ZmdXFtai1zV1lwdFFKWGNcIixcImV4cGlyeVwiOlwiMjAyNS0wNS0wNlQxMzoyMDowNS42OTAwNjQyKzAyOjAwXCJ9In0
<---End paste

Empleados
    * Acceso a registro de citas, clientes, empleados y servicios
Empleados_admin
    * Acceso a registro de citas
        - Coger citas para los clientes
        - Cancelar citas.
    * Acceso a registro de clientes
        - Dar alta nuevo cliente
        - Editar datos clientes
    * Acceso a registro de empleados
        - Dar alta nuevo empleado
        - Editar datos empleados 
            + Hacer admin, 
            + Despedir "activo = 0"
    * Acceso a registro de servicios
        - Dar alta nuevo servicio
        - Editar datos servicios
            + Desactivarlo (activo = 0)
Cliente
    * Visualizar servicios
    * Coger citas
    * Visualizacion de sus citas
        - Cancelar citas futuras
Usuario no registrado
    * Visualizar servicios
    * registrarse